<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('./partials/head') %>
    <title>Create New Story - Blogify</title>
  </head>
  <body>
    <%- include('./partials/nav') %>

    <div class="container mt-5">
      <div class="content-wrapper p-5">
        <div class="text-center mb-5">
          <h1 class="display-6 fw-bold text-dark mb-3">
            <i class="bi bi-pen me-3"></i>Create Your Story
          </h1>
          <p class="lead text-muted">
            Share your thoughts and experiences with the world
          </p>
        </div>

        <div class="row justify-content-center">
          <div class="col-lg-8">
            <form
              action="/blog/"
              method="post"
              enctype="multipart/form-data"
              class="needs-validation"
              novalidate>
              <!-- Title Field -->
              <div class="mb-4">
                <label for="title" class="form-label fw-semibold text-dark">
                  <i class="bi bi-type me-2"></i>Story Title
                </label>
                <input
                  type="text"
                  class="form-control form-control-lg"
                  id="title"
                  name="title"
                  placeholder="Enter an engaging title for your story..."
                  required />
                <div class="invalid-feedback">
                  Please provide a title for your story.
                </div>
              </div>

              <!-- Cover Image Upload -->
              <div class="mb-4">
                <label
                  for="coverImage"
                  class="form-label fw-semibold text-dark">
                  <i class="bi bi-image me-2"></i>Cover Image
                </label>
                <div
                  class="upload-area border-2 border-dashed rounded-3 p-4 text-center"
                  style="border-color: #dee2e6">
                  <input
                    class="form-control d-none"
                    id="coverImage"
                    name="coverImage"
                    type="file"
                    accept="image/*"
                    required />
                  <div class="upload-placeholder">
                    <i class="bi bi-cloud-upload display-4 text-muted mb-3"></i>
                    <h5 class="text-muted mb-2">Choose a cover image</h5>
                    <p class="text-muted mb-3">
                      Drag and drop or click to browse
                    </p>
                    <button
                      type="button"
                      class="btn btn-outline-primary"
                      onclick="document.getElementById('coverImage').click()">
                      <i class="bi bi-folder2-open me-2"></i>Browse Files
                    </button>
                  </div>
                  <div class="upload-preview d-none">
                    <img class="img-thumbnail mb-3" style="max-height: 200px" />
                    <div>
                      <button
                        type="button"
                        class="btn btn-sm btn-outline-secondary"
                        onclick="changeImage()">
                        <i class="bi bi-arrow-clockwise me-1"></i>Change Image
                      </button>
                    </div>
                  </div>
                </div>
                <div class="invalid-feedback">
                  Please select a cover image for your story.
                </div>
              </div>

              <!-- Content Field -->
              <div class="mb-4">
                <label for="body" class="form-label fw-semibold text-dark">
                  <i class="bi bi-file-text me-2"></i>Your Story
                </label>
                <textarea
                  id="body"
                  name="body"
                  class="form-control"
                  rows="12"
                  placeholder="Write your story here... Share your experiences, thoughts, and ideas with the world."
                  required></textarea>
                <div class="invalid-feedback">
                  Please write the content of your story.
                </div>
                <div class="form-text">
                  <i class="bi bi-info-circle me-1"></i>
                  Take your time to craft something meaningful. Your words
                  matter!
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="d-flex gap-3 justify-content-end">
                <a href="/" class="btn btn-outline-secondary btn-lg">
                  <i class="bi bi-arrow-left me-2"></i>Cancel
                </a>
                <button type="submit" class="btn btn-primary btn-lg px-4">
                  <i class="bi bi-send me-2"></i>Publish Story
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <%- include('./partials/scripts') %>

    <script>
      // Form validation
      (function () {
        "use strict";
        window.addEventListener(
          "load",
          function () {
            var forms = document.getElementsByClassName("needs-validation");
            var validation = Array.prototype.filter.call(
              forms,
              function (form) {
                form.addEventListener(
                  "submit",
                  function (event) {
                    if (form.checkValidity() === false) {
                      event.preventDefault();
                      event.stopPropagation();
                    }
                    form.classList.add("was-validated");
                  },
                  false
                );
              }
            );
          },
          false
        );
      })();

      // Image upload preview
      document
        .getElementById("coverImage")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              const uploadArea = document.querySelector(".upload-area");
              const placeholder = uploadArea.querySelector(
                ".upload-placeholder"
              );
              const preview = uploadArea.querySelector(".upload-preview");
              const img = preview.querySelector("img");

              img.src = e.target.result;
              placeholder.classList.add("d-none");
              preview.classList.remove("d-none");
            };
            reader.readAsDataURL(file);
          }
        });

      function changeImage() {
        const uploadArea = document.querySelector(".upload-area");
        const placeholder = uploadArea.querySelector(".upload-placeholder");
        const preview = uploadArea.querySelector(".upload-preview");

        placeholder.classList.remove("d-none");
        preview.classList.add("d-none");
        document.getElementById("coverImage").value = "";
        document.getElementById("coverImage").click();
      }
    </script>
  </body>
</html>
