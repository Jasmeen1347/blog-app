<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('./partials/head') %>
    <title><%= blog.title %> - Blogify</title>
  </head>
  <body>
    <%- include('./partials/nav') %>

    <div class="container mt-5">
      <div class="content-wrapper p-5">
        <!-- Blog Header -->
        <div class="text-center mb-5">
          <h1 class="display-5 fw-bold text-dark mb-4"><%= blog.title %></h1>
          <div
            class="d-flex justify-content-center align-items-center blog-meta mb-4">
            <img
              src="<%= blog.createdBy.profileImageUrl %>"
              class="rounded-circle me-3"
              width="50"
              height="50"
              style="object-fit: cover" />
            <div class="text-start">
              <div class="fw-semibold text-dark">
                <%= blog.createdBy.fullName %>
              </div>
              <small class="text-muted">
                <i class="bi bi-calendar3 me-1"></i>
                <%= new Date(blog.createdAt).toLocaleDateString('en-US', { year:
                'numeric', month: 'long', day: 'numeric' }) %>
              </small>
            </div>
          </div>
        </div>

        <!-- Cover Image -->
        <div class="text-center mb-5">
          <img
            src="<%= blog.coverImageUrl %>"
            class="img-fluid rounded-3 shadow-lg"
            style="max-height: 400px; width: 100%; object-fit: cover"
            alt="<%= blog.title %>" />
        </div>

        <!-- Blog Content -->
        <div class="row justify-content-center">
          <div class="col-lg-8">
            <div class="blog-content">
              <pre
                class="fs-6 lh-lg text-dark"
                style="white-space: pre-wrap; font-family: 'Inter', sans-serif">
<%= blog.body %></pre
              >
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Comments Section -->
    <div class="container mt-4 mb-4">
      <div class="content-wrapper p-5">
        <div class="d-flex align-items-center mb-4">
          <h3 class="fw-bold text-dark mb-0">
            <i class="bi bi-chat-dots me-2"></i>
            Comments (<%= comments.length %>)
          </h3>
        </div>

        <!-- Add Comment Form -->
        <% if (locals.user) { %>
        <div class="mb-5">
          <form action="/blog/comment/<%= blog._id %>" method="post">
            <div class="d-flex gap-3">
              <img
                src="<%= locals.user.profileImageUrl || 'https://via.placeholder.com/40' %>"
                class="rounded-circle"
                width="40"
                height="40"
                style="object-fit: cover" />
              <div class="flex-grow-1">
                <div class="mb-3">
                  <textarea
                    class="form-control"
                    placeholder="Share your thoughts..."
                    name="content"
                    rows="3"
                    required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">
                  <i class="bi bi-send me-2"></i>Post Comment
                </button>
              </div>
            </div>
          </form>
        </div>
        <% } else { %>
        <div class="text-center p-4 bg-light rounded-3 mb-5">
          <p class="text-muted mb-3">Join the conversation!</p>
          <a href="/user/signin" class="btn btn-outline-primary me-2"
            >Sign In</a
          >
          <a href="/user/signup" class="btn btn-primary">Create Account</a>
        </div>
        <% } %>

        <!-- Comments List -->
        <% if (comments.length > 0) { %>
        <div class="comments-list">
          <% comments.forEach((comment, index) => { %>
          <div class="comment-item bg-light rounded-3 p-3 mb-2 border">
            <div class="d-flex gap-3">
              <img
                src="<%= comment.createdBy.profileImageUrl %>"
                class="rounded-circle flex-shrink-0"
                width="42"
                height="42"
                style="object-fit: cover" />
              <div class="flex-grow-1">
                <div
                  class="d-flex align-items-center justify-content-between mb-1">
                  <h6 class="fw-semibold text-dark mb-0 fs-6">
                    <%= comment.createdBy.fullName %>
                  </h6>
                  <small class="text-muted">
                    <i class="bi bi-clock me-1"></i>
                    <%= new Date(comment.createdAt).toLocaleDateString('en-US',
                    { month: 'short', day: 'numeric', year: 'numeric' }) %>
                  </small>
                </div>
                <p class="text-dark mb-2"><%= comment.content %></p>
                <div class="pt-1 border-top border-light">
                  <small class="text-muted">
                    <i class="bi bi-reply me-1"></i>
                    <a href="#" class="text-decoration-none text-muted"
                      >Reply</a
                    >
                    <span class="mx-2">â€¢</span>
                    <i class="bi bi-heart me-1"></i>
                    <a href="#" class="text-decoration-none text-muted">Like</a>
                  </small>
                </div>
              </div>
            </div>
          </div>
          <% }) %>
        </div>
        <% } else { %>
        <div class="text-center py-5">
          <i class="bi bi-chat-square-dots display-4 text-muted mb-3"></i>
          <h5 class="text-muted mb-2">No comments yet</h5>
          <p class="text-muted">
            Be the first to share your thoughts on this story!
          </p>
        </div>
        <% } %>
      </div>
    </div>

    <%- include('./partials/scripts') %>
  </body>
</html>
